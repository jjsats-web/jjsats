# Worklog (2025-02-11)

## สิ่งที่ทำวันนี้
- เพิ่มระบบ PIN gate ทั้งหน้าและ API:
  - middleware บังคับให้ต้องกรอก PIN ก่อนเข้าทุกหน้า (ยกเว้น `/pin`, `/api/pin`, `_next` และ favicon)
  - API `/api/pin` ตรวจ PIN จากตาราง `pins` ใน Supabase และ API `GET /api/pin` ส่งชื่อ-นามสกุลล่าสุด
  - API `/api/pin/register` สำหรับตั้ง/อัปเดต PIN พร้อมบันทึกชื่อ-นามสกุลลง Supabase
- UI PIN:
  - หน้า `/pin` เปลี่ยนเป็น keypad 6 หลักพร้อมจุดสถานะ ถูก/ผิด
  - หน้า `/pin/register` เพิ่มฟอร์มชื่อ/นามสกุล + PIN 6 หลัก
  - แสดงชื่อ-นามสกุลผู้ลงชื่อไว้เหนือหัวข้อหลักในหน้าใบเสนอราคา (`app/page.tsx`) และทะเบียนลูกค้า (`app/customer/page.tsx`)
- Quotation & Customer pages:
  - แจ้งเตือนใช้ SweetAlert2 และดึงชื่อผู้ใช้จาก PIN ที่บันทึกไว้
  - ปรับบางฟอร์มและการจัดวางให้สอดคล้องกับการเปลี่ยนแปลง PIN
- Supabase schema:
  - อัปเดต `pins` ให้มี `first_name`, `last_name` และเพิ่ม SQL สร้าง/อัปเดตใน `SUPABASE.md`
- ติดตั้ง `sweetalert2`

## ไฟล์ที่แก้ไข/เพิ่ม
- `middleware.ts`
- `app/api/pin/route.ts`
- `app/api/pin/register/route.ts`
- `app/pin/page.tsx`
- `app/pin/register/page.tsx`
- `app/page.tsx`
- `app/customer/page.tsx`
- `app/globals.css`
- `lib/supabase/database.types.ts`
- `SUPABASE.md`
- `package-lock.json`

## SQL สำคัญ
- อัปเดตตาราง `pins`:
```sql
alter table public.pins
  add column if not exists first_name text,
  add column if not exists last_name text;
```
หรือใช้สคริปต์เต็มใน `SUPABASE.md` ข้อ 7

