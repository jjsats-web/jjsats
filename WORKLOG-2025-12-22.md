# Worklog (2025-12-22)

## เธชเธฃเธธเธเธชเธดเนเธเธเธตเนเธเธณเธงเธฑเธเธเธตเน

- เนเธเธดเนเธกเธฅเธดเธเธเน โเธญเธญเธเธเธฒเธเธฃเธฐเธเธโ เนเธ topbar เธเธญเธเธซเธเนเธฒเนเธเนเธชเธเธญเธฃเธฒเธเธฒ/เธเธฐเนเธเธตเธขเธเธฅเธนเธเธเนเธฒ/เธชเธดเธเธเนเธฒเธเธฃเธดเธฉเธฑเธ
- เนเธเนเนเธฅเธเธเธตเนเนเธเนเธชเธเธญเธฃเธฒเธเธฒเนเธเธชเนเธงเธเธเธฃเธฐเธงเธฑเธเธดเนเธซเนเนเธชเธเธเนเธเธเธฒเธฐเธเธฑเธงเนเธฅเธ
- เธเนเธญเธเธเธฑเธเธขเนเธญเธเธเธฅเธฑเธเนเธเธซเธเนเธฒ /pin เธซเธฅเธฑเธเธฅเนเธญเธเธญเธดเธ: redirect เธเธตเน middleware + เนเธเน router.replace
- เธเธฃเธฑเธเธฃเธฐเธเธ PIN เนเธซเนเธฃเธญเธเธฃเธฑเธเธซเธฅเธฒเธขเธเธ:
  - เธฅเธเธเธฐเนเธเธตเธขเธ PIN เนเธซเธกเนเนเธเธเนเธกเนเธเธฑเธเธเธญเธเนเธเธดเธก + เธเธฑเธ PIN เธเนเธณ + เธเธฃเธงเธเธฃเธนเธเนเธเธ 6 เธซเธฅเธฑเธ
  - เธฅเนเธญเธเธญเธดเธเนเธเธตเธขเธเธเธฑเธ PIN เธเธฑเนเธเธซเธกเธเนเธฅเธฐเนเธเนเธ PIN เธฅเธเธเธธเธเธเธตเน
  - เธเธถเธเธเธทเนเธญเธเธนเนเนเธเนเธเธฒเธก PIN เธเธตเนเธฅเนเธญเธเธญเธดเธ
  - middleware เธเธทเธญเธงเนเธฒเธกเธตเธเธธเธเธเธตเน PIN เธเนเธเนเธฒเธ gate
- เธเธณเธเธฑเธ input PIN เนเธซเนเธฃเธฑเธเนเธเธเธฒเธฐเธเธฑเธงเนเธฅเธเนเธเธซเธเนเธฒ register

## เนเธเธฅเนเธชเธณเธเธฑเธเธเธตเนเธกเธตเธเธฒเธฃเนเธเนเนเธ

- `app/page.tsx`
- `app/customer/page.tsx`
- `app/product/page.tsx`
- `app/pin/page.tsx`
- `app/pin/register/page.tsx`
- `app/api/pin/route.ts`
- `app/api/pin/register/route.ts`
- `middleware.ts`

## เธเธณเธชเธฑเนเธเธเธตเนเธฃเธฑเธเนเธเธทเนเธญเนเธเนเธเธเธฒเธ

- `npm run lint` (เธเนเธญเธเธเธฒเธฃเธเธฃเธฑเธเธฃเธฐเธเธ PIN เนเธเธเธซเธฅเธฒเธขเธเธ)

## อัปเดตเพิ่มเติม

- เพิ่มส่วนประวัติใบเสนอราคาในหน้าใบเสนอราคาอีกครั้ง (โหลดจาก `/api/quotes`) และปุ่ม Export PDF ต่อรายการ
- ปรับ Export PDF ให้พิมพ์ผ่าน iframe พร้อมฟอร์มใหม่หัวกระดาษบริษัท/ตารางรายการ/สรุปยอด/VAT/ลายเซ็น
- เพิ่มระบบ role (admin/user): ลงทะเบียนเลือก role, เก็บ role ในคุกกี้, ปรับ middleware/API ให้ admin เข้า `/product` และ `/pin/register` เท่านั้น
- ซ่อนเมนูสินค้าบริษัท/ลงทะเบียนใน header สำหรับ user และเอาปุ่มตั้งค่า PIN ใหม่ออกจากหน้า `/pin`
- แสดงชื่อผู้ใช้บนหน้าใบเสนอราคา
- ปรับปุ่มหน้า `/pin/register` ให้สไตล์และความกว้างเท่ากัน
- เพิ่มโลโก้ใหม่สำหรับฟอร์ม PDF

## ไฟล์สำคัญที่มีการแก้ไข (เพิ่มเติม)

- `app/page.tsx`
- `app/customer/page.tsx`
- `app/product/page.tsx`
- `app/pin/manage/page.tsx`
- `app/pin/register/page.tsx`
- `app/pin/page.tsx`
- `app/restricted/page.tsx`
- `app/api/pin/route.ts`
- `app/api/pin/register/route.ts`
- `app/api/pins/route.ts`
- `app/api/pins/[id]/route.ts`
- `middleware.ts`
- `public/jjsats-logo.png`
- `lib/supabase/database.types.ts`

## คำสั่งที่รันเพื่อเช็คงาน (เพิ่มเติม)

- `npm run gen:types`
